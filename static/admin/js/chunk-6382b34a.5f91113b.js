(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6382b34a"],{3759:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Card",{attrs:{shadow:""}},[s("div",{staticStyle:{overflow:"hidden"}},[s("Row",[s("Col",{attrs:{span:"3"}},[s("div",{staticClass:"message-page-con message-category-con",staticStyle:{width:"100%"}},[s("Menu",{attrs:{width:"auto","active-name":"unread"},on:{"on-select":e.handleSelect}},[s("MenuItem",{attrs:{name:"unread"}},[s("span",{staticClass:"category-title"},[e._v("未读消息")]),s("Badge",{staticStyle:{"margin-left":"10px"},attrs:{count:e.messageUnreadCount}})],1),s("MenuItem",{attrs:{name:"readed"}},[s("span",{staticClass:"category-title"},[e._v("已读消息")]),s("Badge",{staticStyle:{"margin-left":"10px"},attrs:{"class-name":"gray-dadge",count:e.messageReadedCount}})],1)],1)],1)]),s("Col",{attrs:{span:"21"}},[s("div",{staticClass:"message-page-con message-list-con",staticStyle:{width:"100%"}},[e.listLoading?s("Spin",{attrs:{fix:"",size:"large"}}):e._e(),s("Menu",{class:e.titleClass,attrs:{width:"100%","active-name":""},on:{"on-select":e.handleView}},e._l(e.messageList,function(t){return s("MenuItem",{key:"msg_"+t.id,staticStyle:{width:"100%"},attrs:{name:t.id}},[s("div",[s("p",{staticClass:"msg-title",staticStyle:{overflow:"hidden","text-overflow":"ellipsis","-webkit-box-orient":"vertical",display:"-webkit-box","-webkit-line-clamp":"3"}},[e._v(e._s(t.message))]),s("Badge",{attrs:{status:"default",text:t.add_time}}),s("Button",{directives:[{name:"show",rawName:"v-show",value:"unread"!==e.currentMessageType,expression:"currentMessageType !== 'unread'"}],staticStyle:{float:"right","margin-right":"20px"},style:{display:t.loading?"inline-block !important":""},attrs:{loading:t.loading,size:"small",icon:"readed"===e.currentMessageType?"md-trash":"md-redo",title:"readed"===e.currentMessageType?"删除":"已读",type:"text"},nativeOn:{click:function(s){return s.stopPropagation(),e.removeMsg(t.id)}}}),s("Button",{directives:[{name:"show",rawName:"v-show",value:"unread"==e.currentMessageType,expression:"currentMessageType == 'unread'"}],staticStyle:{float:"right","margin-right":"20px"},attrs:{icon:"ios-settings"},nativeOn:{click:function(s){return s.stopPropagation(),e.setMsg(t.id)}}},[e._v("设置已读")])],1)])}),1),e.count>1?s("Page",{directives:[{name:"show",rawName:"v-show",value:"unread"==e.currentMessageType,expression:"currentMessageType == 'unread'"}],staticStyle:{margin:"5px 0"},attrs:{total:e.count,"show-elevator":"","show-total":""},on:{"on-change":e.page}}):e._e(),s("Page",{directives:[{name:"show",rawName:"v-show",value:"unread"!=e.currentMessageType,expression:"currentMessageType != 'unread'"}],staticStyle:{margin:"5px 0"},attrs:{total:e.count1,"show-elevator":"","show-total":""},on:{"on-change":e.page1}})],1)])],1)],1)])},n=[],i=(s("7514"),s("cebc")),r=s("2f62"),o=s("c24f"),c=s("66df"),d=s("c276"),u={unread:"messageUnreadList",readed:"messageReadedList",trash:"messageTrashList"},g={name:"message_page",data:function(){return{listLoading:!0,contentLoading:!1,currentMessageType:"unread",messageContent:"",showingMsgItem:{},count:0,count1:0}},computed:Object(i["a"])({},Object(r["e"])({messageUnreadList:function(e){return e.user.messageUnreadList},messageReadedList:function(e){return e.user.messageReadedList},messageTrashList:function(e){return e.user.messageTrashList},messageList:function(){return this.count=this.messageUnreadCount,this.count1=this.messageReadedCount,this[u[this.currentMessageType]]},titleClass:function(){return{"not-unread-list":"unread"!==this.currentMessageType}}}),Object(r["c"])(["messageUnreadCount","messageReadedCount","messageTrashCount"])),methods:Object(i["a"])({},Object(r["d"])([]),Object(r["b"])(["getContentByMsgId","getMessageList","getMessage","hasRead","removeReaded","restoreTrash"]),{stopLoading:function(e){this[e]=!1},handleSelect:function(e){this.currentMessageType=e},handleView:function(e){var t=this;this.contentLoading=!0,this.getContentByMsgId({msg_id:e}).then(function(s){t.messageContent=s;var a=t.messageList.find(function(t){return t.msg_id===e});a&&(t.showingMsgItem=a),"unread"===t.currentMessageType&&t.hasRead({msg_id:e}),t.stopLoading("contentLoading")}).catch(function(){t.stopLoading("contentLoading")})},removeMsg:function(e){var t=this;Object(o["h"])(e,Object(d["k"])("token")).then(function(s){t.$store.state.user.messageReadedList.map(function(s,a){s.id==e&&t.$store.state.user.messageReadedList.splice(a,1)})})},setMsg:function(e){var t=new FormData;t.append("active",1);Object(o["i"])(e,t,Object(d["k"])("token")).then(function(e){window.location.reload()})},page:function(e){var t=this,s="unread"==this.currentMessageType?"/api/UserMessages/?page="+e+"&type=unread":"/api/UserMessages/?page="+e+"&type=read";c["a"].request({url:s,headers:{Authorization:"JWT "+Object(d["k"])("token")},method:"get"}).then(function(e){t.$store.state.user.messageUnreadList=e.data.results})},page1:function(e){var t=this,s="unread"==this.currentMessageType?"/api/UserMessages/?page="+e+"&type=unread":"/api/UserMessages/?page="+e+"&type=read";c["a"].request({url:s,headers:{Authorization:"JWT "+Object(d["k"])("token")},method:"get"}).then(function(e){t.$store.state.user.messageReadedList=e.data.results})}}),mounted:function(){var e=this;this.listLoading=!0,console.log(this.$store.state.user),this.getMessageList().then(function(){return e.stopLoading("listLoading")}).catch(function(){return e.stopLoading("listLoading")}),this.getMessage().then(function(){return e.stopLoading("listLoading")}).catch(function(){return e.stopLoading("listLoading")})}},l=g,h=(s("ac69"),s("2877")),p=Object(h["a"])(l,a,n,!1,null,null,null);t["default"]=p.exports},ac69:function(e,t,s){"use strict";var a=s("e850"),n=s.n(a);n.a},e850:function(e,t,s){}}]);